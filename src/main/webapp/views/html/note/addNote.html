<html>
<head>
<title>Blog Programming</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<link rel="stylesheet" href="http://localhost:8080/pz/views/css/common/common.css" type="text/css" />
<link rel="stylesheet" href="http://localhost:8080/pz/views/css/common/nav.css" type="text/css" />
<link rel="stylesheet" href="http://localhost:8080/pz/views/static/css/font-awesome.min.css" type="text/css" />
<style type="text/css">
span{
	cursor:pointer;
	margin:2px 2px;
	-moz-user-select:none; /*火狐*/
	-webkit-user-select:none; /*webkit浏览器*/
	-ms-user-select:none; /*IE10*/
	-khtml-user-select:none; /*早期浏览器*/
	user-select:none;
}
#title{
	text-align:left;
	vertical-align:middle;
}
</style>
<script type="text/javascript" src="http://localhost:8080/pz/views/js/jquery/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="http://localhost:8080/pz/views/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="http://localhost:8080/pz/views/ckeditor/config.js"></script>
<script type="text/javascript" src="http://localhost:8080/pz/views/ckfinder/ckfinder.js"></script>
<script type="text/javascript">
    var editor = null;
    window.onload = function(){
    	//CKFinder.setupCKEditor();
        editor = CKEDITOR.replace('ckeditor');//参数‘ckeditor’是textarea元素的name属性值，而非id属性值
        editor.getData();
        CKFinder.setupCKEditor( editor, '../' ) ;
        editor.on("instanceReady", function (evt) {
        	editor.addCommand("save", {exec: function (editor) {
        		alert(editor.getData());
        	}});
        });
    }
</script>
</head>
<body>
<div class="nav">
	<div class="menu">
		<ul>
			<li><a href="/zone/home/home"><i class="fa fa-home fa-fw"></i>首页</a></li>
			<li><a href="/zone/note/archive"><i class="fa fa-archive fa-fw"></i>归档</a></li>
			<li><a href="/zone/note/category"><i class="fa fa-th fa-fw"></i>分类</a></li>
			<li><a href="/zone/note/tag"><i class="fa fa-tags fa-fw"></i>标签</a></li>
			<li><a href="/zone/about"><i class="fa fa-user fa-fw"></i>关于</a></li>
		</ul>
	</div>
</div>

<div class="wrapper">
	<div class="content">
		<div class="title" id="title">
			<label>题目:</label>
			<input name="note_title" id="note_title" autofocus="autofocus" value="" style="font-size:20px;width:580px;height:30px"><p>
		</div>
		<div id=textContent>
		    <textarea id="ckeditor" name="ckeditor"></textarea>
		    <button type="button" id="submit">保存</button>
		</div>
		<div class="category">
			<label>分类:</label>
			<div class="categoryId" id="categoryId">
			</div>
		</div>
		<div class="tag" id="tag">
			<label>标签:</label>
			<div class="tagId" id="tagId">
				<span id="coffee">加奶油</span>
			</div>
		</div>
	</div>
</div>
<script>
	$(document).ready(function(){
		var data = '';
		var JsonData = JSON.stringify(data);
		$.ajax({
			url:'http://localhost:8080/pz/category/categoryList.do',
			type:'POST',
			dataType:'json',
			contentType:'application/json',
			data:JsonData,
			async:false,
			success:function(data){
				console.log(JSON.stringify(data));
				var html = '';
				var categorys = data.dataList;
				for(var i=0; i<categorys.length; i++){
					var category = categorys[i];
					html+='<span style="margin: 2px 2px;">'+category.name+'</span>';
				}
				console.log(html);
				$('#categoryId').html(html);
			},
			error:function(xhr){
				alert("123")
			}
		});
		$("#tag span").click(function(){
			this.setAttribute("click", "on");
			alert(("clickv" in this));
			if(!("clickv" in this)||this.getAttribute("clickv")=="off"){
				this.style.backgroundColor='#ccc';
				this.setAttribute("clickv","on");
			}else{
				this.style.backgroundColor='#fff';
				this.setAttribute("clickv","off");
			}
			//this.setAttribute("click", "on");
			/*
			if(this.style.backgroundColor=='#fff'){
				this.style.backgroundColor='#ccc';
			}else{
				this.style.backgroundColor='#fff';
			}*/
		});
		$('#textContent #submit').click(function(){
			var title =  $('#note_title').val();
			var category =  $('#category').val();
			var tag =  $('#tag').val();
			var data = {
					'title':title,
					'note':editor.getData()
			}
			var JsonData = JSON.stringify(data);
			$.ajax({
				url:'http://localhost:8080/pz/article/addArticle.do',
				type:'POST',
				dataType:'json',
				contentType:'application/json',
				data:JsonData,
				async:false,
				success:function(data){
					var id = data.article.id;
					window.location.href ="http://localhost:8080/pz/views/jsp/note/noteDetail.html?id="+id;
				}
			});
		});
	});
</script>
</body>
</html>